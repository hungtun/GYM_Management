{% extends "layout/base.html" %}

{% block title %}Danh sÃ¡ch há»™i viÃªn - Huáº¥n luyá»‡n viÃªn{% endblock %}

{% block extra_css %}
<style>
    .member-card {
        border-radius: 14px;
        border: 1px solid #edf2f7;
        transition: transform 0.2s, box-shadow 0.2s;
        height: 100%;
    }

    .member-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.08);
    }

    .member-meta span {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        margin-right: 12px;
        font-size: 0.9rem;
        color: #6b7280;
    }

    .pagination .page-link {
        border-radius: 8px;
        margin: 0 3px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show"
        role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <div class="d-flex flex-wrap justify-content-between align-items-center mb-4 gap-3">
        <div>
            <h2 class="mb-1">Há»™i viÃªn báº¡n Ä‘ang quáº£n lÃ½</h2>
            <p class="text-muted mb-0">{{ total_members }} há»™i viÃªn</p>
        </div>
        <a href="{{ url_for('trainer.dashboard') }}" class="btn btn-secondary">
            â† Quay láº¡i Dashboard
        </a>
    </div>

    {% if members %}
    <div class="row g-4">
        {% for member in members %}
        <div class="col-md-6 col-lg-4">
            <div class="card member-card">
                <div class="card-body d-flex flex-column gap-2">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h5 class="card-title mb-1">
                                {{ member.user.first_name or '' }} {{ member.user.last_name or '' }}
                            </h5>
                            <span class="badge bg-{{ 'success' if member.status == 'active' else 'secondary' }}">
                                {{ member.status }}
                            </span>
                        </div>
                        <small class="text-muted">
                            {{ member.register_date.strftime('%d/%m/%Y') }}
                        </small>
                    </div>
                    <div class="member-meta">
                        <span>ğŸ“§ {{ member.user.email }}</span>
                        <span>ğŸ“ {{ member.user.phone or 'ChÆ°a cÃ³' }}</span>
                    </div>
                    <div class="d-flex gap-2 mt-auto">
                        <a href="{{ url_for('trainer.create_plan', member_id=member.id) }}"
                            class="btn btn-sm btn-primary flex-grow-1">
                            â• Táº¡o káº¿ hoáº¡ch
                        </a>
                        <a href="{{ url_for('trainer.plans', member_id=member.id) }}"
                            class="btn btn-sm btn-outline-secondary">
                            ğŸ“‹ Xem káº¿ hoáº¡ch
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    {% set start_item = ((page - 1) * page_size) + 1 %}
    {% set end_item = (page * page_size) if (page * page_size) < total_members else total_members %} <div
        class="d-flex flex-wrap justify-content-between align-items-center mt-4 text-muted small">
        <span>Hiá»ƒn thá»‹ {{ start_item }} - {{ end_item }} trÃªn tá»•ng {{ total_members }} há»™i viÃªn</span>
</div>

{% if total_pages > 1 %}
<nav class="mt-3">
    <ul class="pagination justify-content-center">
        <li class="page-item {% if page == 1 %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('trainer.members', page=page-1) }}" aria-label="Previous">
                &laquo;
            </a>
        </li>
        {% for p in range(1, total_pages + 1) %}
        <li class="page-item {% if p == page %}active{% endif %}">
            <a class="page-link" href="{{ url_for('trainer.members', page=p) }}">{{ p }}</a>
        </li>
        {% endfor %}
        <li class="page-item {% if page == total_pages %}disabled{% endif %}">
            <a class="page-link" href="{{ url_for('trainer.members', page=page+1) }}" aria-label="Next">
                &raquo;
            </a>
        </li>
    </ul>
</nav>
{% endif %}
{% else %}
<div class="alert alert-info text-center">
    <p class="mb-0">Báº¡n chÆ°a cÃ³ há»™i viÃªn nÃ o Ä‘Æ°á»£c gÃ¡n.</p>
    <p class="mb-0">Há»™i viÃªn sáº½ xuáº¥t hiá»‡n á»Ÿ Ä‘Ã¢y sau khi báº¡n táº¡o káº¿ hoáº¡ch táº­p luyá»‡n cho há».</p>
</div>
{% endif %}
</div>
{% endblock %}